{% extends 'accounts/base.html' %}

{% block title %}Dashboard - S_CONTABLE{% endblock %}

{% block content %}
<style>
    body {
        background: #f8f9fa;
    }
    .navbar {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .dashboard-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        transition: transform 0.3s ease;
    }
    .dashboard-card:hover {
        transform: translateY(-5px);
    }
    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
    }
</style>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand fw-bold" href="#">
            <i class="fas fa-calculator me-2"></i>S_CONTABLE
        </a>
        <button class="navbar-toggler" 
                type="button" 
                data-bs-toggle="collapse" 
                data-bs-target="#navbarNav"
                aria-controls="navbarNav"
                aria-expanded="false"
                aria-label="Alternar navegación"
                tabindex="0"
                onKeyDown="handleKeyPress(event, this)"
                onKeyUp="handleKeyPress(event, this)">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link active" 
                       href="{% url 'accounts:dashboard' %}"
                       aria-current="page"
                       tabindex="0"
                       onKeyDown="handleKeyPress(event, this)"
                       onKeyUp="handleKeyPress(event, this)">
                        <i class="fas fa-tachometer-alt me-1" aria-hidden="true"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" 
                       href="#"
                       tabindex="0"
                       aria-label="Ir a sección de contabilidad"
                       onKeyDown="handleKeyPress(event, this)"
                       onKeyUp="handleKeyPress(event, this)">
                        <i class="fas fa-book me-1" aria-hidden="true"></i>Contabilidad
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" 
                       href="#"
                       tabindex="0"
                       aria-label="Ver reportes del sistema"
                       onKeyDown="handleKeyPress(event, this)"
                       onKeyUp="handleKeyPress(event, this)">
                        <i class="fas fa-chart-bar me-1" aria-hidden="true"></i>Reportes
                    </a>
                </li>
            </ul>
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" 
                       href="#" 
                       id="navbarDropdown" 
                       role="button" 
                       data-bs-toggle="dropdown"
                       aria-expanded="false"
                       aria-label="Menú de usuario {{ user.username }}"
                       tabindex="0"
                       onKeyDown="handleKeyPress(event, this)"
                       onKeyUp="handleKeyPress(event, this)">
                        <i class="fas fa-user me-1" aria-hidden="true"></i>{{ user.username }}
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li>
                            <a class="dropdown-item" 
                               href="#"
                               tabindex="0"
                               aria-label="Ver perfil de usuario"
                               onKeyDown="handleKeyPress(event, this)"
                               onKeyUp="handleKeyPress(event, this)">
                                <i class="fas fa-user-cog me-2" aria-hidden="true"></i>Perfil
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" 
                               href="#"
                               tabindex="0"
                               aria-label="Configuración del sistema"
                               onKeyDown="handleKeyPress(event, this)"
                               onKeyUp="handleKeyPress(event, this)">
                                <i class="fas fa-cog me-2" aria-hidden="true"></i>Configuración
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <form method="post" action="{% url 'accounts:logout' %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" 
                                        class="dropdown-item" 
                                        style="border: none; background: none; width: 100%; text-align: left;"
                                        aria-label="Cerrar sesión y salir del sistema"
                                        tabindex="0"
                                        onKeyDown="handleKeyPress(event, this)"
                                        onKeyUp="handleKeyPress(event, this)">
                                    <i class="fas fa-sign-out-alt me-2" aria-hidden="true"></i>Cerrar Sesión
                                </button>
                            </form>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Main Content -->
<div class="container mt-4">
    <!-- Welcome Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="dashboard-card p-4">
                <h2 class="text-primary mb-3">
                    <i class="fas fa-home me-2"></i>Bienvenido, {{ user.username }}!
                </h2>
                <p class="text-muted mb-0">
                    Bienvenido a tu sistema contable. Desde aquí puedes gestionar todas tus operaciones financieras.
                </p>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="dashboard-card p-4 text-center">
                <div class="stat-icon mx-auto mb-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="fas fa-users"></i>
                </div>
                <h5 class="mb-1">Clientes</h5>
                <h3 class="text-primary mb-0">0</h3>
                <small class="text-muted">Total registrados</small>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="dashboard-card p-4 text-center">
                <div class="stat-icon mx-auto mb-3" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                    <i class="fas fa-file-invoice-dollar"></i>
                </div>
                <h5 class="mb-1">Facturas</h5>
                <h3 class="text-success mb-0">0</h3>
                <small class="text-muted">Este mes</small>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="dashboard-card p-4 text-center">
                <div class="stat-icon mx-auto mb-3" style="background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h5 class="mb-1">Ingresos</h5>
                <h3 class="text-warning mb-0">$0</h3>
                <small class="text-muted">Este mes</small>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="dashboard-card p-4 text-center">
                <div class="stat-icon mx-auto mb-3" style="background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h5 class="mb-1">Pendientes</h5>
                <h3 class="text-danger mb-0">0</h3>
                <small class="text-muted">Por revisar</small>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="dashboard-card p-4">
                <h5 class="mb-3">
                    <i class="fas fa-bolt me-2"></i>Acciones Rápidas
                </h5>
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-primary w-100" 
                                type="button"
                                tabindex="0"
                                aria-label="Crear nueva factura"
                                onKeyDown="handleKeyPress(event, this)"
                                onKeyUp="handleKeyPress(event, this)">
                            <i class="fas fa-plus me-2" aria-hidden="true"></i>Nueva Factura
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-success w-100"
                                type="button"
                                tabindex="0"
                                aria-label="Agregar nuevo cliente"
                                onKeyDown="handleKeyPress(event, this)"
                                onKeyUp="handleKeyPress(event, this)">
                            <i class="fas fa-user-plus me-2" aria-hidden="true"></i>Nuevo Cliente
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-info w-100"
                                type="button"
                                tabindex="0"
                                aria-label="Ver reportes financieros"
                                onKeyDown="handleKeyPress(event, this)"
                                onKeyUp="handleKeyPress(event, this)">
                            <i class="fas fa-chart-bar me-2" aria-hidden="true"></i>Ver Reportes
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-warning w-100"
                                type="button"
                                tabindex="0"
                                aria-label="Abrir configuración del sistema"
                                onKeyDown="handleKeyPress(event, this)"
                                onKeyUp="handleKeyPress(event, this)">
                            <i class="fas fa-cog me-2" aria-hidden="true"></i>Configuración
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="row">
        <div class="col-12">
            <div class="dashboard-card p-4">
                <h5 class="mb-3">
                    <i class="fas fa-clock me-2"></i>Actividad Reciente
                </h5>
                <div class="text-center py-5">
                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                    <p class="text-muted">No hay actividad reciente para mostrar.</p>
                    <p class="text-muted">Comienza creando tu primera factura o cliente.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
/**
 * Manejador de eventos de teclado para accesibilidad
 * Permite activar elementos interactivos con Enter y Espacio
 */
function handleKeyPress(event, element) {
    // Solo manejar eventos de keydown para evitar duplicados
    if (event.type !== 'keydown') return;
    
    const key = event.key || event.which || event.keyCode;
    
    // Enter (13) o Espacio (32)
    if (key === 'Enter' || key === ' ' || key === 13 || key === 32) {
        event.preventDefault();
        
        // Si es un botón, hacer click
        if (element.tagName === 'BUTTON') {
            element.click();
        }
        // Si es un enlace, navegar
        else if (element.tagName === 'A') {
            if (element.href && element.href !== '#') {
                globalThis.location.href = element.href;
            } else {
                element.click();
            }
        }
        // Para otros elementos, simular click
        else {
            element.click();
        }
    }
}

/**
 * Mejorar navegación con teclado
 */
document.addEventListener('DOMContentLoaded', function() {
    // Agregar indicadores visuales para elementos enfocados
    const style = document.createElement('style');
    style.textContent = `
        .btn:focus,
        .nav-link:focus,
        .dropdown-item:focus,
        .navbar-toggler:focus {
            outline: 2px solid #667eea !important;
            outline-offset: 2px !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3) !important;
        }
        
        .btn:focus-visible,
        .nav-link:focus-visible,
        .dropdown-item:focus-visible {
            outline: 2px solid #667eea !important;
            outline-offset: 2px !important;
        }
        
        /* Mejorar contraste para usuarios con discapacidades visuales */
        @media (prefers-contrast: high) {
            .btn, .nav-link, .dropdown-item {
                border: 2px solid currentColor !important;
            }
        }
        
        /* Respetar preferencias de movimiento reducido */
        @media (prefers-reduced-motion: reduce) {
            .btn, .dashboard-card, * {
                transition: none !important;
                animation: none !important;
            }
        }
    `;
    document.head.appendChild(style);
    
    // Mejorar navegación con Tab
    const interactiveElements = document.querySelectorAll('button, a, [tabindex="0"]');
    interactiveElements.forEach(function(element, index) {
        element.addEventListener('keydown', function(event) {
            handleKeyPress(event, this);
        });
        
        // Agregar soporte para navegación con flechas en grupos
        if (element.closest('.row')) {
            element.addEventListener('keydown', function(event) {
                const key = event.key;
                if (key === 'ArrowRight' || key === 'ArrowLeft') {
                    const siblings = Array.from(element.closest('.row').querySelectorAll('button, a'));
                    const currentIndex = siblings.indexOf(element);
                    
                    let nextIndex;
                    if (key === 'ArrowRight') {
                        nextIndex = (currentIndex + 1) % siblings.length;
                    } else {
                        nextIndex = currentIndex === 0 ? siblings.length - 1 : currentIndex - 1;
                    }
                    
                    if (siblings[nextIndex]) {
                        event.preventDefault();
                        siblings[nextIndex].focus();
                    }
                }
            });
        }
    });
    
    // Anunciar cambios para lectores de pantalla
    const announcer = document.createElement('div');
    announcer.setAttribute('aria-live', 'polite');
    announcer.setAttribute('aria-atomic', 'true');
    announcer.className = 'sr-only';
    document.body.appendChild(announcer);
    
    // Función para anunciar mensajes
    globalThis.announceToScreenReader = function(message) {
        announcer.textContent = message;
        setTimeout(() => {
            announcer.textContent = '';
        }, 1000);
    };
});
</script>
{% endblock %}
